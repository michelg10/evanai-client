<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EvanAI Debug Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
            background: #0a0a0a;
            color: #e0e0e0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: #1a1a1a;
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-section {
            padding: 20px;
            border-bottom: 1px solid #333;
            overflow-y: auto;
        }

        .sidebar-section h3 {
            color: #00ff88;
            margin-bottom: 15px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        .header {
            background: #1a1a1a;
            padding: 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #00ff88;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-connected {
            background: #00ff8833;
            color: #00ff88;
            border: 1px solid #00ff88;
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            display: flex;
            gap: 20px;
            padding: 20px;
            overflow: hidden;
        }

        /* Messages Section */
        .messages-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1a1a1a;
            border-radius: 8px;
            border: 1px solid #333;
        }

        .messages-header {
            padding: 15px 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            background: #222;
            border: 1px solid #333;
        }

        .message.user {
            background: #003366;
            border-color: #0066cc;
            margin-left: 20%;
        }

        .message.assistant {
            background: #1a2f1a;
            border-color: #00ff88;
            margin-right: 20%;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 12px;
            opacity: 0.7;
        }

        .message-content {
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Input Section */
        .input-section {
            padding: 20px;
            border-top: 1px solid #333;
            display: flex;
            gap: 10px;
        }

        .input-field {
            flex: 1;
            background: #222;
            border: 1px solid #333;
            color: #e0e0e0;
            padding: 12px;
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            min-height: 50px;
        }

        .input-field:focus {
            outline: none;
            border-color: #00ff88;
        }

        .send-button {
            padding: 12px 24px;
            background: #00ff88;
            color: #000;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s;
        }

        .send-button:hover {
            background: #00cc6a;
            transform: translateY(-2px);
        }

        .send-button:disabled {
            background: #444;
            color: #888;
            cursor: not-allowed;
            transform: none;
        }

        /* Tool Calls Section */
        .tool-calls-section {
            width: 400px;
            background: #1a1a1a;
            border-radius: 8px;
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
        }

        .tool-calls-header {
            padding: 15px 20px;
            border-bottom: 1px solid #333;
            color: #ffaa00;
            font-weight: bold;
        }

        .tool-calls {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .tool-call {
            margin-bottom: 15px;
            padding: 12px;
            background: #222;
            border: 1px solid #333;
            border-radius: 6px;
        }

        .tool-call.success {
            border-color: #00ff88;
        }

        .tool-call.error {
            border-color: #ff4444;
        }

        .tool-call-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .tool-name {
            color: #ffaa00;
            font-weight: bold;
        }

        .tool-status {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
        }

        .tool-status.success {
            background: #00ff8833;
            color: #00ff88;
        }

        .tool-status.error {
            background: #ff444433;
            color: #ff4444;
        }

        .tool-params, .tool-result {
            margin-top: 8px;
            padding: 8px;
            background: #111;
            border-radius: 4px;
            font-size: 12px;
            overflow-x: auto;
        }

        /* Tool List */
        .tool-item {
            padding: 8px;
            margin-bottom: 8px;
            background: #222;
            border: 1px solid #333;
            border-radius: 4px;
            font-size: 12px;
        }

        .tool-item-name {
            color: #ffaa00;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .tool-item-desc {
            font-size: 11px;
            opacity: 0.8;
            line-height: 1.4;
        }

        /* System Info */
        .system-info {
            font-size: 12px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #333;
        }

        .info-label {
            color: #888;
        }

        .info-value {
            color: #00ff88;
        }

        /* Buttons */
        .action-button {
            padding: 8px 16px;
            background: #333;
            color: #e0e0e0;
            border: 1px solid #555;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .action-button:hover {
            background: #444;
            border-color: #00ff88;
        }

        .action-button.danger {
            border-color: #ff4444;
        }

        .action-button.danger:hover {
            background: #ff444433;
            color: #ff4444;
        }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #333;
            border-top-color: #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #111;
        }

        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            color: #00ff88;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: #888;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
        }

        .modal-close:hover {
            color: #fff;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .tool-selector {
            margin-bottom: 20px;
        }

        .tool-selector select {
            width: 100%;
            padding: 10px;
            background: #222;
            border: 1px solid #333;
            color: #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
        }

        .parameter-inputs {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .parameter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .parameter-label {
            color: #ffaa00;
            font-size: 12px;
            font-weight: bold;
        }

        .parameter-desc {
            color: #888;
            font-size: 11px;
            margin-bottom: 5px;
        }

        .parameter-input {
            padding: 10px;
            background: #222;
            border: 1px solid #333;
            color: #e0e0e0;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 13px;
        }

        .parameter-input:focus {
            outline: none;
            border-color: #00ff88;
        }

        textarea.parameter-input {
            min-height: 100px;
            resize: vertical;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #333;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .execute-button {
            padding: 10px 20px;
            background: #00ff88;
            color: #000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }

        .execute-button:hover {
            background: #00cc6a;
        }

        .execute-button:disabled {
            background: #444;
            color: #888;
            cursor: not-allowed;
        }

        .tool-result-display {
            margin-top: 20px;
            padding: 15px;
            background: #111;
            border: 1px solid #333;
            border-radius: 4px;
            display: none;
        }

        .tool-result-display.show {
            display: block;
        }

        .tool-result-display pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #e0e0e0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-section">
            <h3>üõ†Ô∏è Available Tools</h3>
            <div id="tools-list"></div>
        </div>
        <div class="sidebar-section">
            <h3>üìä System Info</h3>
            <div id="system-info" class="system-info"></div>
        </div>
        <div class="sidebar-section">
            <h3>üéÆ Controls</h3>
            <button class="action-button" onclick="loadTools()">üîÑ Refresh Tools</button>
            <br><br>
            <button class="action-button" onclick="openManualToolModal()">üîß Manual Tool Call</button>
            <br><br>
            <button class="action-button danger" onclick="resetConversation()">üóëÔ∏è Reset Conversation</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <h1>
                <span>ü§ñ</span>
                <span>EvanAI Debug Interface</span>
            </h1>
            <div class="status-badge status-connected">‚óè READY</div>
        </div>

        <!-- Chat Container -->
        <div class="chat-container">
            <!-- Messages Section -->
            <div class="messages-section">
                <div class="messages-header">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span>üí¨ Conversation</span>
                        <span id="conversation-uuid" style="font-size: 11px; opacity: 0.7; color: #00ff88; font-family: monospace;"></span>
                    </div>
                    <span id="message-count">0 messages</span>
                </div>
                <div id="messages" class="messages"></div>
                <div class="input-section">
                    <textarea id="prompt-input" class="input-field" placeholder="Enter your prompt here..." onkeydown="handleKeyPress(event)"></textarea>
                    <button id="send-button" class="send-button" onclick="sendPrompt()">Send</button>
                </div>
            </div>

            <!-- Tool Calls Section -->
            <div class="tool-calls-section">
                <div class="tool-calls-header">‚ö° Tool Executions</div>
                <div id="tool-calls" class="tool-calls">
                    <div style="padding: 20px; text-align: center; opacity: 0.5;">
                        No tool calls yet
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Manual Tool Call Modal -->
    <div id="manualToolModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîß Manual Tool Execution</h2>
                <button class="modal-close" onclick="closeManualToolModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tool-selector">
                    <label style="color: #888; font-size: 12px; display: block; margin-bottom: 5px;">Select Tool:</label>
                    <select id="toolSelect" onchange="updateToolParameters()"></select>
                </div>
                <div id="parameterInputs" class="parameter-inputs"></div>
                <div id="toolResultDisplay" class="tool-result-display">
                    <strong style="color: #00ff88;">Result:</strong>
                    <pre id="toolResultContent"></pre>
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-button" onclick="closeManualToolModal()">Cancel</button>
                <button id="executeToolButton" class="execute-button" onclick="executeManualTool()">Execute</button>
            </div>
        </div>
    </div>

    <script>
        let conversationId = 'debug-session-' + Date.now();
        let messageCount = 0;
        let isProcessing = false;
        let availableTools = [];

        // Update conversation UUID display
        function updateConversationDisplay() {
            const uuidElement = document.getElementById('conversation-uuid');
            if (uuidElement) {
                uuidElement.textContent = `UUID: ${conversationId}`;
            }
        }

        // Initialize
        window.onload = () => {
            loadTools();
            loadSystemInfo();
            updateConversationDisplay();
            document.getElementById('prompt-input').focus();
        };

        // Load available tools
        async function loadTools() {
            try {
                const response = await fetch('/api/tools');
                const data = await response.json();

                availableTools = data.tools;

                const toolsList = document.getElementById('tools-list');
                toolsList.innerHTML = '';

                data.tools.forEach(tool => {
                    const toolItem = document.createElement('div');
                    toolItem.className = 'tool-item';
                    toolItem.innerHTML = `
                        <div class="tool-item-name">${tool.name}</div>
                        <div class="tool-item-desc">${tool.description}</div>
                    `;
                    toolsList.appendChild(toolItem);
                });
            } catch (error) {
                console.error('Failed to load tools:', error);
            }
        }

        // Load system info
        async function loadSystemInfo() {
            try {
                const response = await fetch('/api/system');
                const data = await response.json();

                const systemInfo = document.getElementById('system-info');
                systemInfo.innerHTML = `
                    <div class="info-item">
                        <span class="info-label">Model:</span>
                        <span class="info-value">${data.model}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Max Tokens:</span>
                        <span class="info-value">${data.max_tokens}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Tools:</span>
                        <span class="info-value">${data.tool_count}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Runtime:</span>
                        <span class="info-value">${data.runtime_dir}</span>
                    </div>
                `;
            } catch (error) {
                console.error('Failed to load system info:', error);
            }
        }

        // Send prompt
        async function sendPrompt() {
            if (isProcessing) return;

            const input = document.getElementById('prompt-input');
            const prompt = input.value.trim();

            if (!prompt) return;

            isProcessing = true;
            input.disabled = true;
            document.getElementById('send-button').disabled = true;

            // Add user message to UI
            addMessage('user', prompt);
            input.value = '';

            // Clear tool calls
            document.getElementById('tool-calls').innerHTML = '<div style="padding: 10px; text-align: center;"><div class="loading"></div></div>';

            try {
                const response = await fetch('/api/prompt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: prompt,
                        conversation_id: conversationId
                    })
                });

                const data = await response.json();

                if (data.error) {
                    addMessage('assistant', `Error: ${data.error}`);
                    console.error('Error details:', data.details);
                } else {
                    // Add assistant response
                    addMessage('assistant', data.response);

                    // Display tool calls
                    displayToolCalls(data.tool_calls);
                }
            } catch (error) {
                addMessage('assistant', `Error: ${error.message}`);
                console.error('Request failed:', error);
            } finally {
                isProcessing = false;
                input.disabled = false;
                document.getElementById('send-button').disabled = false;
                input.focus();
            }
        }

        // Add message to UI
        function addMessage(role, content) {
            const messages = document.getElementById('messages');
            const message = document.createElement('div');
            message.className = `message ${role}`;

            const timestamp = new Date().toLocaleTimeString();
            message.innerHTML = `
                <div class="message-header">
                    <span>${role === 'user' ? 'üë§ User' : 'ü§ñ Assistant'}</span>
                    <span>${timestamp}</span>
                </div>
                <div class="message-content">${escapeHtml(content)}</div>
            `;

            messages.appendChild(message);
            messages.scrollTop = messages.scrollHeight;

            messageCount++;
            document.getElementById('message-count').textContent = `${messageCount} messages`;
        }

        // Display tool calls
        function displayToolCalls(toolCalls) {
            const container = document.getElementById('tool-calls');

            if (!toolCalls || toolCalls.length === 0) {
                container.innerHTML = '<div style="padding: 20px; text-align: center; opacity: 0.5;">No tool calls</div>';
                return;
            }

            container.innerHTML = '';

            toolCalls.forEach(call => {
                const toolCall = document.createElement('div');
                toolCall.className = `tool-call ${call.status}`;

                toolCall.innerHTML = `
                    <div class="tool-call-header">
                        <span class="tool-name">${call.tool_id}</span>
                        <span class="tool-status ${call.status}">${call.status} ${call.execution_time || ''}</span>
                    </div>
                    <div class="tool-params">
                        <strong>Parameters:</strong><br>
                        ${JSON.stringify(call.parameters, null, 2)}
                    </div>
                    ${call.result ? `
                        <div class="tool-result">
                            <strong>Result:</strong><br>
                            ${JSON.stringify(call.result, null, 2)}
                        </div>
                    ` : ''}
                    ${call.error ? `
                        <div class="tool-result" style="color: #ff4444;">
                            <strong>Error:</strong><br>
                            ${call.error}
                        </div>
                    ` : ''}
                `;

                container.appendChild(toolCall);
            });
        }

        // Handle key press
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendPrompt();
            }
        }

        // Reset conversation
        async function resetConversation() {
            if (!confirm('Reset the current conversation? This will clear all messages.')) return;

            try {
                await fetch('/api/reset', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ conversation_id: conversationId })
                });

                // Clear UI
                document.getElementById('messages').innerHTML = '';
                document.getElementById('tool-calls').innerHTML = '<div style="padding: 20px; text-align: center; opacity: 0.5;">No tool calls yet</div>';
                messageCount = 0;
                document.getElementById('message-count').textContent = '0 messages';

                // Generate new conversation ID
                conversationId = 'debug-session-' + Date.now();
                updateConversationDisplay();
            } catch (error) {
                console.error('Failed to reset conversation:', error);
            }
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Manual Tool Modal Functions
        function openManualToolModal() {
            const modal = document.getElementById('manualToolModal');
            const select = document.getElementById('toolSelect');

            // Clear previous results
            document.getElementById('toolResultDisplay').classList.remove('show');
            document.getElementById('toolResultContent').textContent = '';

            // Populate tool dropdown
            select.innerHTML = '<option value="">-- Select a tool --</option>';
            availableTools.forEach((tool, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = tool.name;
                select.appendChild(option);
            });

            // Clear parameter inputs
            document.getElementById('parameterInputs').innerHTML = '';

            modal.classList.add('show');
        }

        function closeManualToolModal() {
            document.getElementById('manualToolModal').classList.remove('show');
        }

        function updateToolParameters() {
            const select = document.getElementById('toolSelect');
            const selectedIndex = select.value;
            const paramContainer = document.getElementById('parameterInputs');

            if (!selectedIndex || selectedIndex === '') {
                paramContainer.innerHTML = '';
                return;
            }

            const tool = availableTools[selectedIndex];
            paramContainer.innerHTML = '';

            if (tool.input_schema && tool.input_schema.properties) {
                Object.entries(tool.input_schema.properties).forEach(([key, schema]) => {
                    const paramGroup = document.createElement('div');
                    paramGroup.className = 'parameter-group';

                    const label = document.createElement('label');
                    label.className = 'parameter-label';
                    label.textContent = key + (tool.input_schema.required && tool.input_schema.required.includes(key) ? ' *' : '');
                    paramGroup.appendChild(label);

                    if (schema.description) {
                        const desc = document.createElement('div');
                        desc.className = 'parameter-desc';
                        desc.textContent = schema.description;
                        paramGroup.appendChild(desc);
                    }

                    let input;
                    if (schema.type === 'boolean') {
                        input = document.createElement('select');
                        input.className = 'parameter-input';
                        input.innerHTML = '<option value="false">false</option><option value="true">true</option>';
                    } else if (schema.type === 'integer' || schema.type === 'number') {
                        input = document.createElement('input');
                        input.type = 'number';
                        input.className = 'parameter-input';
                        if (schema.default !== undefined) {
                            input.value = schema.default;
                        }
                    } else if (schema.type === 'object' || schema.type === 'array') {
                        input = document.createElement('textarea');
                        input.className = 'parameter-input';
                        input.placeholder = 'Enter JSON...';
                        if (schema.default !== undefined) {
                            input.value = JSON.stringify(schema.default, null, 2);
                        }
                    } else {
                        // String or other types
                        if (key === 'command' || (schema.description && schema.description.includes('command'))) {
                            input = document.createElement('textarea');
                        } else {
                            input = document.createElement('input');
                            input.type = 'text';
                        }
                        input.className = 'parameter-input';
                        if (schema.default !== undefined) {
                            input.value = schema.default;
                        }
                    }

                    input.id = 'param_' + key;
                    paramGroup.appendChild(input);

                    paramContainer.appendChild(paramGroup);
                });
            } else {
                paramContainer.innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">No parameters required for this tool</div>';
            }
        }

        async function executeManualTool() {
            const select = document.getElementById('toolSelect');
            const selectedIndex = select.value;

            if (!selectedIndex || selectedIndex === '') {
                alert('Please select a tool');
                return;
            }

            const tool = availableTools[selectedIndex];
            const button = document.getElementById('executeToolButton');
            button.disabled = true;

            // Gather parameters
            const parameters = {};
            if (tool.input_schema && tool.input_schema.properties) {
                for (const [key, schema] of Object.entries(tool.input_schema.properties)) {
                    const input = document.getElementById('param_' + key);
                    if (input) {
                        let value = input.value;

                        // Convert types
                        if (schema.type === 'boolean') {
                            value = value === 'true';
                        } else if (schema.type === 'integer' || schema.type === 'number') {
                            value = value ? Number(value) : undefined;
                        } else if (schema.type === 'object' || schema.type === 'array') {
                            try {
                                value = value ? JSON.parse(value) : undefined;
                            } catch (e) {
                                alert(`Invalid JSON for parameter ${key}: ${e.message}`);
                                button.disabled = false;
                                return;
                            }
                        }

                        if (value !== undefined && value !== '') {
                            parameters[key] = value;
                        }
                    }
                }
            }

            // Check required parameters
            if (tool.input_schema && tool.input_schema.required) {
                for (const key of tool.input_schema.required) {
                    if (!(key in parameters)) {
                        alert(`Required parameter missing: ${key}`);
                        button.disabled = false;
                        return;
                    }
                }
            }

            try {
                const response = await fetch('/api/tool/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        tool_id: tool.name,
                        parameters: parameters,
                        conversation_id: conversationId
                    })
                });

                const data = await response.json();

                // Display result
                const resultDisplay = document.getElementById('toolResultDisplay');
                const resultContent = document.getElementById('toolResultContent');

                if (data.error) {
                    resultContent.textContent = `Error: ${data.error}`;
                    resultDisplay.style.borderColor = '#ff4444';
                } else {
                    resultContent.textContent = JSON.stringify(data.result, null, 2);
                    resultDisplay.style.borderColor = '#00ff88';
                }

                resultDisplay.classList.add('show');

                // Also add to tool calls display
                const toolCall = {
                    tool_id: tool.name,
                    parameters: parameters,
                    result: data.result,
                    error: data.error,
                    status: data.error ? 'error' : 'success',
                    execution_time: data.execution_time ? `${data.execution_time.toFixed(2)}s` : '',
                    manual: true
                };
                displayToolCalls([toolCall]);

            } catch (error) {
                const resultDisplay = document.getElementById('toolResultDisplay');
                const resultContent = document.getElementById('toolResultContent');
                resultContent.textContent = `Request failed: ${error.message}`;
                resultDisplay.style.borderColor = '#ff4444';
                resultDisplay.classList.add('show');
            } finally {
                button.disabled = false;
            }
        }
    </script>
</body>
</html>